<!doctype html><html lang=en><head><title>Splunk notes</title><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.357dd1de946e0748ed1ed88009a6203f270bccbdabe5793ab4aab15964be163a.css integrity="sha256-NX3R3pRuB0jtHtiACaYgPycLzL2r5Xk6tKqxWWS+Fjo="><link rel=icon type=image/png href=/images/site/favicon_hu_c11ce0d32209d128.png><link rel=alternate type=application/rss+xml href=https://siemforge.xyz/notes/2.splunk/index.xml title=SIEMForge><meta property="og:title" content="SIEMForge"><meta property="og:type" content="website"><meta property="og:description" content="Portfolio and personal blog of Benny Temmerman, SIEMForge"><meta property="og:image" content="/images/site/background.jpg"><meta property="og:url" content="https://siemforge.xyz"><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-notes kind-section" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu_c11ce0d32209d128.png id=logo alt=Logo>
SIEMForge</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/#experiences>Experiences</a></li><li class=nav-item><a class=nav-link href=/#education>Education</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>More</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/#projects>Projects</a>
<a class=dropdown-item href=/#featured-posts>Featured Posts</a>
<a class=dropdown-item href=/#accomplishments>Accomplishments</a></div></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li><li class=nav-item><a class=nav-link id=note-link href=/notes>Notes</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu_c11ce0d32209d128.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu_c11ce0d32209d128.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/notes data-filter=all>Notes</a></li><div class=subtree><li><i data-feather=minus-circle></i><a class="active list-link" href=/notes/2.splunk/> Splunk</a><ul class=active><li><a class=list-link href=/notes/2.splunk/spl/ title=SPL>SPL</a></li><li><a class=list-link href=/notes/2.splunk/cli/ title=CLI>CLI</a></li><li><a class=list-link href=/notes/2.splunk/splunk-upgrade/ title=Upgrade>Upgrade</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/3.sentinel/> Sentinel</a><ul><li><a class=list-link href=/notes/3.sentinel/kql/ title=KQL>KQL</a></li><li><a class=list-link href=/notes/3.sentinel/logstash_cli/ title="Logstash CLI">Logstash CLI</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/4.linux/> Linux</a><ul><li><a class=list-link href=/notes/4.linux/cli/ title=Bash>Bash</a></li><li><a class=list-link href=/notes/4.linux/logrotate/ title=Logrotate>Logrotate</a></li><li><a class=list-link href=/notes/4.linux/lvm/lvm_cheatsheet/ title="LVM cheatsheet">LVM cheatsheet</a></li><li><a class=list-link href=/notes/4.linux/fdisk/ title=fdisk>fdisk</a></li><li><a class=list-link href=/notes/4.linux/tcpdump/tcpdump_cheatsheet/ title="TCPDump cheatsheet">TCPDump cheatsheet</a></li><li><a class=list-link href=/notes/4.linux/scripts/addsudouser/ title=script-SudoUser>script-SudoUser</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/5.tools/> Tools</a><ul><li><a class=list-link href=/notes/5.tools/ncdu/ title=ncdu>ncdu</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/6.coding/> Coding</a><ul><li><a class=list-link href=/notes/6.coding/python/ title=Python>Python</a></li><li><a class=list-link href=/notes/6.coding/git/ title=GIT>GIT</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class="content container-fluid" id=content><div class="container-fluid note-card-holder" id=note-card-holder><div style=display:block;width:100%;max-width:none><div class=note-card><div class=item><h5 class=note-title><span></span></h5><div class=card><div class=card-body><blockquote><p>Most queries are tested on my onprem homelab servers. Sometimes rights might be limited for example in SplunkCloud for &ldquo;| rest&rdquo; queries.<br>Using tstats is faster to search in large datapools.</p></blockquote></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Troubleshooting:</span></h5><div class=card><div class=card-body><p>When troubleshooting I mostly start with this query:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>_internal log_level<span style=color:#f92672>=</span>ERROR source<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/opt/splunk/var/log/splunk/splunkd.log&#34;</span>
</span></span></code></pre></div><p>Errorcheck Splunkd.log within Splunk GUI</p></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Reporting:</span></h5><div class=card><div class=card-body><p>When checking the health status of the environment, I use the following queries to provide insight:</p><h3 id=general>General</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest splunk_server<span style=color:#f92672>=</span>* count<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> /services/server/info 
</span></span><span style=display:flex><span>| table version host
</span></span></code></pre></div><p>Check Splunk version</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest /services/server/info 
</span></span><span style=display:flex><span>| eval LastStartupTime<span style=color:#f92672>=</span>strftime<span style=color:#f92672>(</span>startup_time, <span style=color:#e6db74>&#34;%Y/%m/%d  %H:%M:%S&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| eval timenow<span style=color:#f92672>=</span>now<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>| eval daysup <span style=color:#f92672>=</span> round<span style=color:#f92672>((</span>timenow - startup_time<span style=color:#f92672>)</span> / 86400,0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| eval Uptime <span style=color:#f92672>=</span> tostring<span style=color:#f92672>(</span>daysup<span style=color:#f92672>)</span> + <span style=color:#e6db74>&#34; Days&#34;</span>
</span></span><span style=display:flex><span>| table splunk_server LastStartupTime Uptime
</span></span></code></pre></div><p>List server uptime</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest /services/authentication/users splunk_server<span style=color:#f92672>=</span>local
</span></span><span style=display:flex><span>| fields title roles email
</span></span><span style=display:flex><span>| rename title as username
</span></span></code></pre></div><p>List users and their roles</p><h3 id=logsources>Logsources</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| tstats values<span style=color:#f92672>(</span>host<span style=color:#f92672>)</span> as recent_host where index<span style=color:#f92672>=</span>* by host, index, sourcetype
</span></span><span style=display:flex><span>| search NOT <span style=color:#f92672>[</span>| inputlookup monitored_systems.csv | fields host | rename host as recent_host<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>| table recent_host, index, sourcetype
</span></span></code></pre></div><p>Overview of non-monitored hosts:
Using a lookupfile to keep track of hosts that we monitor. An alert is used to trigger if a host is not sending logs for a certain threshold.<br>This search compares the hosts found that are currently sending logs in the configured timewindow and compares them to the alreadt monitored hosts in the lookupfile.</p><h3 id=universal-forwarders>Universal forwarders</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>_internal sourcetype<span style=color:#f92672>=</span>splunkd group<span style=color:#f92672>=</span>tcpin_connections version<span style=color:#f92672>=</span>* os<span style=color:#f92672>=</span>* arch<span style=color:#f92672>=</span>* build<span style=color:#f92672>=</span>* hostname<span style=color:#f92672>=</span>* source<span style=color:#f92672>=</span>*metrics.log 
</span></span><span style=display:flex><span>| stats latest<span style=color:#f92672>(</span>version<span style=color:#f92672>)</span> as version,latest<span style=color:#f92672>(</span>arch<span style=color:#f92672>)</span> as arch,latest<span style=color:#f92672>(</span>os<span style=color:#f92672>)</span> as os,latest<span style=color:#f92672>(</span>build<span style=color:#f92672>)</span> as build by hostname
</span></span></code></pre></div><p>List universal forwarders and their version</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| tstats values<span style=color:#f92672>(</span>host<span style=color:#f92672>)</span> where index<span style=color:#f92672>=</span>* by index
</span></span></code></pre></div><p>Overview of hosts sending logs by index</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>_internal source<span style=color:#f92672>=</span>*metrics.log group<span style=color:#f92672>=</span>tcpin_connections 
</span></span><span style=display:flex><span>| stats  sum<span style=color:#f92672>(</span>kb<span style=color:#f92672>)</span> as total_kb by host, hostname   
</span></span><span style=display:flex><span>| table  hostname, host, total_kb
</span></span></code></pre></div><p>List which hosts are sending through which server/forwarder + volume of data</p><h3 id=indexes--sourcetypes>Indexes + sourcetypes</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>_internal source<span style=color:#f92672>=</span>*license_usage.log type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Usage&#34;</span> idx<span style=color:#f92672>=</span>*
</span></span><span style=display:flex><span>| timechart span<span style=color:#f92672>=</span>1d sum<span style=color:#f92672>(</span>b<span style=color:#f92672>)</span> as b by st
</span></span><span style=display:flex><span>| foreach * <span style=color:#f92672>[</span> eval <span style=color:#e6db74>&lt;&lt;FIELD&gt;&gt; = round(&#39;&lt;&lt;FIELD</span>&gt;&gt;<span style=color:#960050;background-color:#1e0010>&#39;</span>/1024/1024/1024,2<span style=color:#f92672>)</span> <span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Overview of volume per day by sourcetype</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>_internal source<span style=color:#f92672>=</span>*license_usage.log type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Usage&#34;</span> earliest<span style=color:#f92672>=</span>-7d@d latest<span style=color:#f92672>=</span>@d
</span></span><span style=display:flex><span>| eval _time<span style=color:#f92672>=</span>strftime<span style=color:#f92672>(</span>_time, <span style=color:#e6db74>&#34;%Y-%m-%d&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| stats sum<span style=color:#f92672>(</span>b<span style=color:#f92672>)</span> as bytes by _time
</span></span><span style=display:flex><span>| eval GB<span style=color:#f92672>=</span>round<span style=color:#f92672>(</span>bytes/1024/1024/1024,2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| table _time GB
</span></span><span style=display:flex><span>| sort - _time
</span></span></code></pre></div><p>total volume per day for past 7 days</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>_internal source<span style=color:#f92672>=</span>*license_usage.log type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Usage&#34;</span>
</span></span><span style=display:flex><span>| bin _time span<span style=color:#f92672>=</span>1d
</span></span><span style=display:flex><span>| stats sum<span style=color:#f92672>(</span>b<span style=color:#f92672>)</span> as b by idx, _time
</span></span><span style=display:flex><span>| eval GB<span style=color:#f92672>=</span>round<span style=color:#f92672>((</span>b/31556952<span style=color:#f92672>)</span>,2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| eventstats sum<span style=color:#f92672>(</span>GB<span style=color:#f92672>)</span> as total_GB by _time
</span></span><span style=display:flex><span>| eval percentage<span style=color:#f92672>=</span>round<span style=color:#f92672>((</span>GB/total_GB<span style=color:#f92672>)</span>*100,2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| sort -_time -GB
</span></span><span style=display:flex><span>| fields - b, total_GB
</span></span><span style=display:flex><span>| rename idx as Index, GB as <span style=color:#e6db74>&#34;Size (GB)&#34;</span>, percentage as <span style=color:#e6db74>&#34;Percentage (%)&#34;</span>
</span></span><span style=display:flex><span>| convert timeformat<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;%Y-%m-%d&#34;</span> ctime<span style=color:#f92672>(</span>_time<span style=color:#f92672>)</span> as Date
</span></span><span style=display:flex><span>| fields Date, Index, <span style=color:#e6db74>&#34;Size (GB)&#34;</span>, <span style=color:#e6db74>&#34;Percentage (%)&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>```</span><span style=color:#66d9ef>for</span> years, divide b/31556952; <span style=color:#66d9ef>for</span> days, divide b/31556952<span style=color:#e6db74>```</span>
</span></span></code></pre></div><p>Usage per day by index + percentages</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest splunk_server<span style=color:#f92672>=</span>* /services/data/indexes 
</span></span><span style=display:flex><span>| eval <span style=color:#e6db74>&#34;Retention Period (months)&#34;</span><span style=color:#f92672>=</span>round<span style=color:#f92672>((</span>frozenTimePeriodInSecs/2628000<span style=color:#f92672>)</span>,0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| search NOT title IN <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;_*&#34;</span>, <span style=color:#e6db74>&#34;main&#34;</span>, <span style=color:#e6db74>&#34;history&#34;</span>, <span style=color:#e6db74>&#34;summary&#34;</span>, <span style=color:#e6db74>&#34;splunklogger&#34;</span><span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>| table title <span style=color:#e6db74>&#34;Retention Period (months)&#34;</span> 
</span></span><span style=display:flex><span>| rename title as Index
</span></span><span style=display:flex><span><span style=color:#e6db74>```</span><span style=color:#66d9ef>for</span> years, divide frozenTimePeriodInSecs/31556952; <span style=color:#66d9ef>for</span> days, divide frozenTimePeriodInSecs/86400<span style=color:#e6db74>```</span>
</span></span></code></pre></div><p>List indexes with the retention period</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| tstats values<span style=color:#f92672>(</span>sourcetype<span style=color:#f92672>)</span> as sourcetype WHERE index<span style=color:#f92672>=</span>* OR index<span style=color:#f92672>=</span>_* by index 
</span></span></code></pre></div><p>List sourcetypes per index</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| metadata type<span style=color:#f92672>=</span>sourcetypes index<span style=color:#f92672>=</span>&lt;index_name&gt;
</span></span><span style=display:flex><span>| table sourcetype
</span></span></code></pre></div><p>List sourcetypes in specific index</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>_internal source<span style=color:#f92672>=</span>*license_usage.log type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Usage&#34;</span> idx<span style=color:#f92672>=</span>&lt;index_name&gt;
</span></span><span style=display:flex><span>| stats sum<span style=color:#f92672>(</span>b<span style=color:#f92672>)</span> as b by st
</span></span><span style=display:flex><span>| eval GB<span style=color:#f92672>=</span>round<span style=color:#f92672>((</span>b/1024/1024/1024<span style=color:#f92672>)</span>,2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| eventstats sum<span style=color:#f92672>(</span>GB<span style=color:#f92672>)</span> as total_GB
</span></span><span style=display:flex><span>| eval percentage<span style=color:#f92672>=</span>round<span style=color:#f92672>((</span>GB/total_GB<span style=color:#f92672>)</span>*100,2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| sort -GB
</span></span><span style=display:flex><span>| fields - b, total_GB
</span></span><span style=display:flex><span>| rename st as <span style=color:#e6db74>&#34;Sourcetype&#34;</span>, GB as <span style=color:#e6db74>&#34;Size (GB)&#34;</span>, percentage as <span style=color:#e6db74>&#34;Percentage (%)&#34;</span>
</span></span><span style=display:flex><span>| fields <span style=color:#e6db74>&#34;Sourcetype&#34;</span>, <span style=color:#e6db74>&#34;Size (GB)&#34;</span>, <span style=color:#e6db74>&#34;Percentage (%)&#34;</span>
</span></span></code></pre></div><p>List sourcetypes in specific index by volume per sourcetype</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>eu_cato
</span></span><span style=display:flex><span>| dedup sourcetype
</span></span><span style=display:flex><span>| table _time sourcetype _raw
</span></span></code></pre></div><p>Quick and dirty example log extraction per sourcetype</p><h3 id=datamodels>Datamodels</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| tstats count FROM datamodel<span style=color:#f92672>=</span>&lt;datamode_name&gt; BY sourcetype
</span></span></code></pre></div><p>find sourcetypes used in specific datamodel</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest /servicesNS/-/-/saved/searches splunk_server<span style=color:#f92672>=</span>local
</span></span><span style=display:flex><span>| rex field<span style=color:#f92672>=</span>title <span style=color:#e6db74>&#34;^(standard|custom)\-production\-alert\-(?&lt;SPA&gt;.*)&#34;</span>
</span></span><span style=display:flex><span>| where SPA!<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>| rex field<span style=color:#f92672>=</span>qualifiedSearch <span style=color:#e6db74>&#34;collect\sindex=(?&lt;into_index&gt;(sla|slad))\s.*&#34;</span>
</span></span><span style=display:flex><span>| eval into_index <span style=color:#f92672>=</span> coalesce<span style=color:#f92672>(</span>into_index, <span style=color:#e6db74>&#39;action.logevent.param.index&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| fillnull value<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-&#34;</span> into_index
</span></span><span style=display:flex><span>| search into_index<span style=color:#f92672>=</span>* eai:acl.app<span style=color:#f92672>=</span>&lt;app_name&gt;
</span></span><span style=display:flex><span>| eval is_scheduled<span style=color:#f92672>=</span><span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>is_scheduled<span style=color:#f92672>==</span><span style=color:#ae81ff>1</span> AND disabled<span style=color:#f92672>==</span>0,<span style=color:#e6db74>&#34;Active&#34;</span>,<span style=color:#e6db74>&#34;Not active&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| rex field<span style=color:#f92672>=</span>description <span style=color:#e6db74>&#34;(?&lt;use_case&gt;^([^.]+))&#34;</span>
</span></span><span style=display:flex><span>| rex field<span style=color:#f92672>=</span>search <span style=color:#e6db74>&#34;(FROM datamodel=(\&#34;)?(?&lt;tstats_datamodel&gt;\w+))&#34;</span>
</span></span><span style=display:flex><span>| rex field<span style=color:#f92672>=</span>search <span style=color:#e6db74>&#34;(WHERE nodename=\&#34;(\w+\.)?(?&lt;tstats_nodename&gt;\w+))&#34;</span>
</span></span><span style=display:flex><span>| rex field<span style=color:#f92672>=</span>search <span style=color:#e6db74>&#34;(?&lt;first_row&gt;[^\r\n].*)&#34;</span>
</span></span><span style=display:flex><span>| rex field<span style=color:#f92672>=</span>first_row <span style=color:#e6db74>&#34;(\`(?&lt;macro&gt;.*?)\`)|(\| from datamodel (?&lt;datamodel&gt;.*))|(index=\&#34;?(?&lt;index&gt;\w+)\&#34;?)|(sourcetype=\&#34;?(?&lt;sourcetype&gt;\w+(:\w+)?)\&#34;?)&#34;</span>
</span></span><span style=display:flex><span>| eval dependency_tmp <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span><span style=color:#f92672>(</span>isnotnull<span style=color:#f92672>(</span>tstats_datamodel<span style=color:#f92672>)</span> AND isnotnull<span style=color:#f92672>(</span>tstats_nodename<span style=color:#f92672>)</span>, tstats_datamodel + <span style=color:#e6db74>&#34;.&#34;</span> + tstats_nodename,
</span></span><span style=display:flex><span>    isnotnull<span style=color:#f92672>(</span>tstats_datamodel<span style=color:#f92672>)</span> AND isnull<span style=color:#f92672>(</span>tstats_nodename<span style=color:#f92672>)</span>, tstats_datamodel,
</span></span><span style=display:flex><span>    isnotnull<span style=color:#f92672>(</span>macro<span style=color:#f92672>)</span>, <span style=color:#e6db74>&#34;`&#34;</span> + macro + <span style=color:#e6db74>&#34;`&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| eval dependency <span style=color:#f92672>=</span> coalesce<span style=color:#f92672>(</span>dependency_tmp, datamodel, index, sourcetype<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| eval indicator_type <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span><span style=color:#f92672>(</span>isnotnull<span style=color:#f92672>(</span>tstats_datamodel<span style=color:#f92672>)</span> OR isnotnull<span style=color:#f92672>(</span>tstats_nodename<span style=color:#f92672>)</span>, <span style=color:#e6db74>&#34;tstats&#34;</span>,
</span></span><span style=display:flex><span>    isnotnull<span style=color:#f92672>(</span>macro<span style=color:#f92672>)</span>, <span style=color:#e6db74>&#34;macro&#34;</span>,
</span></span><span style=display:flex><span>    isnotnull<span style=color:#f92672>(</span>datamodel<span style=color:#f92672>)</span>, <span style=color:#e6db74>&#34;datamodel&#34;</span>,
</span></span><span style=display:flex><span>    isnotnull<span style=color:#f92672>(</span>index<span style=color:#f92672>)</span>, <span style=color:#e6db74>&#34;index&#34;</span>,
</span></span><span style=display:flex><span>    isnotnull<span style=color:#f92672>(</span>sourcetype<span style=color:#f92672>)</span>, <span style=color:#e6db74>&#34;sourcetype&#34;</span>,
</span></span><span style=display:flex><span>    true<span style=color:#f92672>()</span>, <span style=color:#e6db74>&#34;other&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| table title, SPA, use_case, indicator_type, dependency, is_scheduled, into_index, cron_schedule,
</span></span><span style=display:flex><span>| rename use_case AS <span style=color:#e6db74>&#34;use case&#34;</span>
</span></span><span style=display:flex><span>| sort + SPA
</span></span><span style=display:flex><span>| fields - SPA
</span></span><span style=display:flex><span>| search dependency IN <span style=color:#f92672>(</span>&lt;data_model1&gt;, &lt;data_model2&gt;<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Find alerts related to datamodels</p><blockquote><p>Mind that this is something custom and might not work in your environment. This is more of a sidenote for me to reference to.</p></blockquote><h3 id=licenses>Licenses</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest splunk_server<span style=color:#f92672>=</span>local <span style=color:#e6db74>&#34;/services/licenser/licenses&#34;</span>
</span></span><span style=display:flex><span>| eval creation_time<span style=color:#f92672>=</span>strftime<span style=color:#f92672>(</span>creation_time,<span style=color:#e6db74>&#34;%d-%m-%Y&#34;</span><span style=color:#f92672>)</span>, days_until_expiration<span style=color:#f92672>=</span>round<span style=color:#f92672>((</span>expiration_time-now<span style=color:#f92672>())</span>/86400<span style=color:#f92672>)</span> , expiration<span style=color:#f92672>=</span>strftime<span style=color:#f92672>(</span>expiration_time,<span style=color:#e6db74>&#34;%d-%m-%Y&#34;</span><span style=color:#f92672>)</span> ,quota <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;quota&#39;</span>/1024/1024/1024<span style=color:#f92672>)</span>, Volume <span style=color:#f92672>=</span> quota+<span style=color:#e6db74>&#34; GB&#34;</span>, is_unlimited <span style=color:#f92672>=</span><span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;is_unlimited&#39;</span><span style=color:#f92672>==</span>0,<span style=color:#e6db74>&#34;no&#34;</span>,<span style=color:#e6db74>&#34;yes&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| fields  creation_time days_until_expiration expiration expiration_time Volume stack_id status subgroup_id type window_period max_violations label is_unlimited group_id features eai:acl.perms.write eai:acl.perms.read quota
</span></span><span style=display:flex><span>| eval renewal_period <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span><span style=color:#f92672>(</span>days_until_expiration&lt;14, <span style=color:#e6db74>&#34;critical&#34;</span>, days_until_expiration&lt;30, <span style=color:#e6db74>&#34;warning&#34;</span>, 1<span style=color:#f92672>=</span>1, <span style=color:#e6db74>&#34;Ok&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| eval quota1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span><span style=color:#f92672>(</span>quota&gt;1000, quota/1024<span style=color:#f92672>)</span> , quota1 <span style=color:#f92672>=</span> quota1+<span style=color:#e6db74>&#34; TB&#34;</span>
</span></span><span style=display:flex><span>| eval quota2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span><span style=color:#f92672>(</span>quota&lt;1, quota*1024<span style=color:#f92672>)</span> , quota2 <span style=color:#f92672>=</span> quota2+<span style=color:#e6db74>&#34; MB&#34;</span>
</span></span><span style=display:flex><span>| eval Volume <span style=color:#f92672>=</span> coalesce<span style=color:#f92672>(</span>quota1,quota2,Volume<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| fields group_id label Volume creation_time expiration renewal_period days_until_expiration is_unlimited   
</span></span><span style=display:flex><span>| rename creation_time AS <span style=color:#e6db74>&#34;Purchase&#34;</span>, expiration AS <span style=color:#e6db74>&#34;Expiration&#34;</span>, renewal_period AS <span style=color:#e6db74>&#34;Renewal&#34;</span>, days_until_expiration AS <span style=color:#e6db74>&#34;Remaining Days&#34;</span>, is_unlimited AS Unlimited,  group_id AS <span style=color:#e6db74>&#34;License Type&#34;</span> , features AS <span style=color:#e6db74>&#34;Available Features&#34;</span> , label AS License
</span></span></code></pre></div><p>List information about Licenses, including expiration dates.</p><h3 id=deployment-server--apps>Deployment server + apps</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest /services/deployment/server/applications
</span></span><span style=display:flex><span>| stats list<span style=color:#f92672>(</span>title<span style=color:#f92672>)</span>, count<span style=color:#f92672>(</span>title<span style=color:#f92672>)</span> by serverclasses
</span></span><span style=display:flex><span>| rename list<span style=color:#f92672>(</span>title<span style=color:#f92672>)</span> as apps, count<span style=color:#f92672>(</span>title<span style=color:#f92672>)</span> as <span style=color:#e6db74>&#34;amount of apps&#34;</span>
</span></span></code></pre></div><p>List serverclasses and apps</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest /services/apps/local 
</span></span><span style=display:flex><span>| search disabled IN <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;false&#34;</span>,0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| table title version description splunk_server
</span></span></code></pre></div><p>List all apps</p><h3 id=parsing--knowledge-objects>Parsing + knowledge objects</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest /services/data/transforms/extractions 
</span></span><span style=display:flex><span>| table eai:acl.app, title, SOURCE_KEY, REGEX, FORMAT, DEST_KEY 
</span></span><span style=display:flex><span>| sort eai:acl.app title 
</span></span><span style=display:flex><span>| eval DEST_KEY<span style=color:#f92672>=</span><span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>DEST_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;N/A&#34;</span>,DEST_KEY<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>| rename eai:acl.app as App, title as Title, SOURCE_KEY as <span style=color:#e6db74>&#34;Source Key&#34;</span>, REGEX as RegEx, FORMAT as Format, DEST_KEY as <span style=color:#e6db74>&#34;Dest Key&#34;</span>  
</span></span></code></pre></div><p>List all extractions</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>| rest /servicesNS/-/-/admin/directory count<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> splunk_server<span style=color:#f92672>=</span>local 
</span></span><span style=display:flex><span>| rename eai:* as *, acl.* as * 
</span></span><span style=display:flex><span>| eval updated<span style=color:#f92672>=</span>strptime<span style=color:#f92672>(</span>updated,<span style=color:#e6db74>&#34;%Y-%m-%dT%H:%M:%S%Z&#34;</span><span style=color:#f92672>)</span>, updated<span style=color:#f92672>=</span><span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>isnull<span style=color:#f92672>(</span>updated<span style=color:#f92672>)</span>,<span style=color:#e6db74>&#34;Never&#34;</span>,strftime<span style=color:#f92672>(</span>updated,<span style=color:#e6db74>&#34;%d %b %Y&#34;</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>| sort type 
</span></span><span style=display:flex><span>| stats list<span style=color:#f92672>(</span>title<span style=color:#f92672>)</span> as title, list<span style=color:#f92672>(</span>type<span style=color:#f92672>)</span> as type, list<span style=color:#f92672>(</span>orphaned<span style=color:#f92672>)</span> as orphaned, list<span style=color:#f92672>(</span>sharing<span style=color:#f92672>)</span> as sharing, list<span style=color:#f92672>(</span>owner<span style=color:#f92672>)</span> as owner, list<span style=color:#f92672>(</span>updated<span style=color:#f92672>)</span> as updated by app 
</span></span></code></pre></div><p>List all knowledge objects</p></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Maintenance:</span></h5><div class=card><div class=card-body><p>Using the following query, it is often used after a Splunk version or app/addon upgrade to compare the amount of logs.<br>Keep in mind that it is using stats, so big pools of data might slow the search down.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>index<span style=color:#f92672>=</span>* earliest<span style=color:#f92672>=</span>-1mon@m-15m latest<span style=color:#f92672>=</span>-1mon@m
</span></span><span style=display:flex><span>| stats min<span style=color:#f92672>(</span>_time<span style=color:#f92672>)</span> as _time count as Count by sourcetype, index
</span></span><span style=display:flex><span>| eval Day<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Last month&#34;</span> 
</span></span><span style=display:flex><span>| fields Day, _time, Count, sourcetype, index
</span></span><span style=display:flex><span>| append <span style=color:#f92672>[</span> search index<span style=color:#f92672>=</span>* earliest<span style=color:#f92672>=</span>-1w@m-15m latest<span style=color:#f92672>=</span>-1w@m 
</span></span><span style=display:flex><span>    | stats min<span style=color:#f92672>(</span>_time<span style=color:#f92672>)</span> as _time count as Count by sourcetype, index
</span></span><span style=display:flex><span>    | eval Day<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Last week&#34;</span> 
</span></span><span style=display:flex><span>    | fields Day, _time, Count, sourcetype, index<span style=color:#f92672>]</span> 
</span></span><span style=display:flex><span>| append <span style=color:#f92672>[</span> search index<span style=color:#f92672>=</span>* earliest<span style=color:#f92672>=</span>-15m@m latest<span style=color:#f92672>=</span>@m
</span></span><span style=display:flex><span>    | stats min<span style=color:#f92672>(</span>_time<span style=color:#f92672>)</span> as _time count as Count by sourcetype, index
</span></span><span style=display:flex><span>    | eval Day<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Today&#34;</span> 
</span></span><span style=display:flex><span>    | fields Day, _time, Count, sourcetype, index<span style=color:#f92672>]</span>     
</span></span><span style=display:flex><span>| sort sourcetype
</span></span></code></pre></div><p>Compare amount of events per sourcetype last 15 minutes with same 15 minutes last week and last month.</p></div></div></div></div></div><div style=display:block;width:100%;max-width:none><div class=note-card><div class=item><h5 class=note-title><span>CLI commands:</span></h5><div class=card><div class=card-body><p>These are some commands to use in CLI, while a gui is available, I like to do most things using the command line interface.</p><h3 id=basic-operations>Basic operations</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk start
</span></span></code></pre></div><p>Start Splunk</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk stop
</span></span></code></pre></div><p>Stop Splunk</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk restart
</span></span></code></pre></div><p>Restart Splunk</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk status
</span></span></code></pre></div><p>Check if Splunk is running</p><h3 id=general-checks>General checks</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk list user | grep admin -B2
</span></span></code></pre></div><p>Check Splunk admins</p><h3 id=splunk-service-setup>Splunk service setup</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk enable
</span></span></code></pre></div><p>Enable Splunk service to start when the host boots up</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk disable
</span></span></code></pre></div><p>Disable Splunk service so it doesn&rsquo;t start when the host boots up</p><h3 id=deployment-server>Deployment server</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk reload deploy-server -class <span style=color:#f92672>[</span>serverclass-name<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Reload a serverclass to push deployment apps without restarting Splunk"</p><h3 id=licenses>Licenses</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk list licenses | grep <span style=color:#e6db74>&#34;expiration_time&#34;</span> | awk -F<span style=color:#e6db74>&#39;:&#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span> | xargs -I<span style=color:#f92672>{}</span> date -d @<span style=color:#f92672>{}</span> +<span style=color:#e6db74>&#34;%Y-%m-%d %H:%M:%S&#34;</span>
</span></span></code></pre></div><p>Check license expiration date</p><h3 id=appsaddons>Apps/addons</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk list app
</span></span></code></pre></div><p>List installed apps and their status</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk list app | grep version /opt/splunk/etc/apps/*/default/app.conf
</span></span></code></pre></div><p>List installed apps and their version (if found)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/splunk install app &lt;path to app.package&gt;
</span></span></code></pre></div><p>Install an app</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/splunk install app &lt;path to app.package&gt; -update <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Update an app</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk remove app <span style=color:#f92672>[</span>appname<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Remove an app</p><h3 id=extra>Extra</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /opt/splunk/var/log/splunk/splunkd_stdout.log | grep <span style=color:#e6db74>&#34;Splunk&gt;&#34;</span> | tail -n <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Find the startup message</p></div></div></div></div></div><div style=display:block;width:100%;max-width:none><div class=note-card><div class=item><h5 class=note-title><span>Upgrade procedure:</span></h5><div class=card><div class=card-body><h1 id=splunk-upgrade-guide>Splunk Upgrade Guide</h1><p>This document provides a step-by-step procedure to upgrade Splunk from an existing version to a newer release. Follow each section carefully to ensure a smooth upgrade process.</p><h2 id=table-of-contents>Table of Contents</h2><ol><li>Preparation</li><li>Download and Transfer Files</li><li>Pre-Upgrade Checks</li><li>Device State Management</li><li>Backup Current Configuration</li><li>Install the New Version</li><li>Post-Upgrade Verification</li><li>Documentation and Communication</li></ol><h2 id=1-preparation>1. Preparation</h2><ul><li>Ensure you have access to the target devices and necessary permissions.</li><li>Confirm the current Splunk version.</li><li>Notify customer and colleagues about the upcoming upgrade.</li><li>Review release notes for the target version.</li></ul><h2 id=2-download-and-transfer-files>2. Download and Transfer Files</h2><h3 id=download-the-splunk-installer>Download the Splunk Installer</h3><p>You can use the wget command to download the package on the host
wget -O splunk-<version>-<hash>-Linux-x86_64.tgz &ldquo;<a href=https://download.splunk.com/products/splunk/releases/ target=_blank rel=noopener>https://download.splunk.com/products/splunk/releases/</a><version>/linux/splunk-<version>-<hash>-Linux-x86_64.tgz&rdquo;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo -i
</span></span><span style=display:flex><span>cd /tmp
</span></span><span style=display:flex><span>wget -O splunk-9.4.3-237ebbd22314-linux-amd64.tgz <span style=color:#e6db74>&#34;https://download.splunk.com/products/splunk/releases/9.4.3/linux/splunk-9.4.3-237ebbd22314-linux-amd64.tgz&#34;</span>
</span></span></code></pre></div><h3 id=transfer-the-installer-to-target-devices>Transfer the Installer to Target Devices</h3><p>Use WinSCP or similar tools to connect and send to the device:
put &ldquo;path\to\splunk-<version>-<hash>-Linux-x86_64.tgz&rdquo; &ldquo;/tmp/splunk-<version>-<hash>-Linux-x86_64.tgz&rdquo;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set path<span style=color:#f92672>=</span>C:<span style=color:#ae81ff>\P</span>rogram Files <span style=color:#f92672>(</span>x86<span style=color:#f92672>)</span><span style=color:#ae81ff>\W</span>inSCP;%path%
</span></span><span style=display:flex><span>winscp sftp://&lt;CLI-account&gt;@&lt;device_NAT_IP&gt;:/tmp
</span></span><span style=display:flex><span>put <span style=color:#e6db74>&#34;path\to\splunk-9.4.3-237ebbd22314-linux-amd64.tgz&#34;</span> <span style=color:#e6db74>&#34;/tmp/splunk-9.4.3-237ebbd22314-linux-amd64.tgz&#34;</span>
</span></span></code></pre></div><p>Use SCP on more recent windows machines or on Linux:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scp <span style=color:#e6db74>&#34;path\to\splunk-9.4.3-237ebbd22314-linux-amd64.tgz&#34;</span> user@remote-ip:<span style=color:#e6db74>&#34;/tmp/splunk-9.4.3-237ebbd22314-linux-amd64.tgz&#34;</span>
</span></span></code></pre></div><h2 id=3-pre-upgrade-checks>3. Pre-Upgrade Checks</h2><p>Check if Splunk has an active process:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ps -ef | grep splunk
</span></span></code></pre></div><p>Check if Splunk is running:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk status
</span></span></code></pre></div><p>Check Splunk version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk --version
</span></span></code></pre></div><h2 id=4-device-state-management>4. Device State Management</h2><p>Check whether a monitoring needs to set the host in maintenance mode</p><p>On Splunk in environments with index clusters: Maintenance mode halts most bucket fixup activity and prevents frequent rolling of hot buckets. It is useful when performing peer upgrades and other maintenance activities on an indexer cluster.
Enable maintenance mode:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk enable maintenance-mode
</span></span></code></pre></div><p>Disable maintenance mode:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk disable maintenance-mode
</span></span></code></pre></div><p>Enable maintenance mode:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk show maintenance-mode
</span></span></code></pre></div><h2 id=5-backup-current-configuration>5. Backup Current Configuration</h2><p>Check KV Store status</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk show kvstore-status
</span></span></code></pre></div><p>Backup KV Store</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk backup kvstore
</span></span></code></pre></div><p>Check backup</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -la /opt/splunk/var/lib/splunk/kvstorebackup/
</span></span></code></pre></div><p>Backup config files</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo -i
</span></span><span style=display:flex><span>cd /tmp
</span></span><span style=display:flex><span>mkdir /tmp/etc_backup<span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%d-%m-%Y&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>cp -a /opt/splunk/etc/ /tmp/etc_backup<span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%d-%m-%Y&#34;</span><span style=color:#66d9ef>)</span>/
</span></span></code></pre></div><p>Check backup</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls /tmp/etc_backup<span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%d-%m-%Y&#34;</span><span style=color:#66d9ef>)</span>/etc
</span></span></code></pre></div><h2 id=6-install-the-new-version>6. Install the New Version</h2><p>stop splunk using Splunk command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk stop
</span></span></code></pre></div><p>stop splunk using systemctl command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl stop splunk
</span></span></code></pre></div><p>Unpack the Installer</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar -xvzf /tmp/splunk-9.4.3-237ebbd22314-linux-amd64.tgz -C /opt/
</span></span></code></pre></div><p>Change the owner of the Splunk folder recursively with the account running Splunk</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chown -R splunk.splunk /opt/splunk
</span></span></code></pre></div><p>Since I&rsquo;m using a splunk user account (created without elevated privileges) to run splunk, I am switching to the account</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>su - splunk
</span></span></code></pre></div><p>Start Splunk with License Acceptance</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk start --accept-license --answer-yes
</span></span></code></pre></div><h2 id=7-post-upgrade-verification>7. Post-Upgrade Verification</h2><p>Check if Splunk is running</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk status
</span></span></code></pre></div><p>Check recent logs for errors</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tail -20f /opt/splunk/var/log/splunk/splunkd.log
</span></span></code></pre></div><p>Check Splunk version</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/splunk/bin/splunk --version
</span></span></code></pre></div><p>Check if Splunk service is run by splunk user</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ps -ef | grep splunkd | grep -v grep
</span></span></code></pre></div><h2 id=8-documentation-and-communication>8. Documentation and Communication</h2><ul><li>Update internal documentation with the new version details.</li><li>Notify customer and colleagues of the successful upgrade.</li><li>Share release notes and any post-upgrade instructions.</li></ul></div></div></div></div></div></div><div class=paginator></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://siemforge.xyz/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://siemforge.xyz/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://siemforge.xyz/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://siemforge.xyz/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://siemforge.xyz/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://siemforge.xyz/#featured-posts>Featured Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://siemforge.xyz/#accomplishments>Accomplishments</a></li><li class=nav-item><a class=smooth-scroll href=https://toha-guides.netlify.app/posts/>Docs</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:benny@siemforge.xyz target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>benny@siemforge.xyz</span></a></li><li><a href=https://github.com/bennytemmerman target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>bennytemmerman</span></a></li><li><a href=https://www.linkedin.com/in/bennytemmerman target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Benny Temmerman</span></a></li><li><a href=tel:************ target=_blank rel=noopener><span><i class="fas fa-phone-alt"></i></span> <span>************</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This site provides information about my personal findings combined with information found on the internet. Projects and articles may be used as inspiration, however I am not responsible for any fun or harm caused.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2025 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.930be624d64a67aaa78804547cad0511dccdd26cda012034047bff3f69582ac9.js integrity="sha256-kwvmJNZKZ6qniARUfK0FEdzN0mzaASA0BHv/P2lYKsk=" defer></script></body></html>